# 褲子分配邏輯說明

## 概述
本文檔說明褲子（短褲和長褲）的分配邏輯。系統已完全更新為全新的分配方式，摒棄了原有的腰圍群組分配方式。

## 新分配邏輯

### 1. 學生排序規則
所有需要褲子的學生按以下優先順序排序：

1. **第一層排序**：按「胸圍 + 腰圍」的總和由小到大排序
2. **第二層排序**：總和相同時，按腰圍由小到大排序  
3. **第三層排序**：腰圍也相同時，按褲長由短到長排序

### 2. 分配順序
- 按照上述排序結果，從第一位學生開始依次分配
- 每位學生從最小尺碼（XS/34）開始尋找可用庫存
- 找到第一個有足夠庫存的尺碼即進行分配

### 3. 褲長監聽器
分配時會根據學生的褲長自動調整尺碼：

- 如果「褲長 - 尺碼數字」在 1-3 之間：升級 1 個尺碼，標記 ↑
- 如果「褲長 - 尺碼數字」≥ 3：升級 2 個尺碼，標記 ↑2
- 升級時如果目標尺碼庫存不足，則維持原尺碼或只升級 1 個尺碼

### 4. 女生特殊交換機制

符合以下條件的女生可與男生交換：

#### 交換條件
1. **L/40 尺碼女生**：褲長 ≤ 35 時，與 M/38 男生交換
2. **XL/42 及以上尺碼女生**：褲長 ≤ 37 時，與小一號尺碼的男生交換

#### 交換規則
- 必須找到相同需求數量的男生
- 選擇「腰圍 + 胸圍 + 褲長」總和最大的男生進行交換
- 女生標記 ↓，男生標記 *
- 如找不到合適男生，則維持原分配

## 實施流程

1. **篩選學生**：找出所有需要褲子的學生
2. **排序**：按新規則排序所有學生
3. **依序分配**：
   - 從最小尺碼開始尋找
   - 應用褲長監聽器調整
   - 檢查是否需要女生交換
   - 扣減庫存，記錄結果
4. **統計結果**：記錄成功、失敗、調整和交換的數量

## 尺碼對照表

| 尺碼 | 數值 |
|------|------|
| XS/34 | 34 |
| S/36 | 36 |
| M/38 | 38 |
| L/40 | 40 |
| XL/42 | 42 |
| 2L/44 | 44 |
| 3L/46 | 46 |
| 4L/48 | 48 |
| 5L/50 | 50 |
| 6L/52 | 52 |
| 7L/54 | 54 |
| 8L/56 | 56 |

## 標記說明

- **↑**：因褲長需求升級 1 個尺碼
- **↑2**：因褲長需求升級 2 個尺碼
- **↓**：女生通過交換獲得較小尺碼
- **\***：男生通過交換獲得較大尺碼

## 注意事項

1. 此邏輯同時適用於短褲和長褲分配
2. 分配失敗的原因包括：無可用尺碼、庫存不足
3. 女生交換機制在分配時即時執行，不是事後調整 